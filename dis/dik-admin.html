<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DIK Admin Panel - almanya101</title>
  <meta name="robots" content="noindex, nofollow">
  <link rel="stylesheet" href="../ubt-shared.css" />
  <link rel="icon" type="image/png" href="../img/icons/headericon.png" />

  <style>
    .admin-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
    }

    .login-card, .admin-card {
      background: #fff;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .login-card h2, .admin-card h2 {
      margin: 0 0 16px 0;
      font-size: 1.4rem;
      color: #333;
    }

    .input-group {
      margin-bottom: 16px;
    }

    .input-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #555;
    }

    .input-group input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1rem;
      box-sizing: border-box;
    }

    .input-group input:focus {
      outline: none;
      border-color: #007bff;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
      color: #fff;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,123,255,0.3);
    }

    .btn-danger {
      background: #dc3545;
      color: #fff;
    }

    .btn-success {
      background: #28a745;
      color: #fff;
    }

    .btn-secondary {
      background: #6c757d;
      color: #fff;
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 0.85rem;
    }

    .stats-row {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .stat-box {
      background: #f8f9fa;
      padding: 12px 20px;
      border-radius: 8px;
      text-align: center;
      flex: 1;
      min-width: 100px;
    }

    .stat-box .number {
      font-size: 1.8rem;
      font-weight: 700;
      color: #333;
    }

    .stat-box .label {
      font-size: 0.85rem;
      color: #666;
    }

    .filter-row {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 8px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      background: #fff;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
    }

    .filter-btn:hover {
      border-color: #007bff;
    }

    .filter-btn.active {
      background: #007bff;
      color: #fff;
      border-color: #007bff;
    }

    .feedback-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .feedback-item {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 16px;
      border-left: 4px solid #007bff;
    }

    .feedback-item.read {
      border-left-color: #28a745;
      opacity: 0.8;
    }

    .feedback-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      flex-wrap: wrap;
      gap: 8px;
    }

    .feedback-meta {
      font-size: 0.85rem;
      color: #666;
    }

    .feedback-status {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .feedback-status.pending {
      background: #fff3cd;
      color: #856404;
    }

    .feedback-status.read {
      background: #d4edda;
      color: #155724;
    }

    .feedback-message {
      background: #fff;
      padding: 12px;
      border-radius: 8px;
      margin: 12px 0;
      white-space: pre-wrap;
      word-break: break-word;
      line-height: 1.5;
    }

    .feedback-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .error-msg {
      background: #f8d7da;
      color: #721c24;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 16px;
    }

    .hidden {
      display: none !important;
    }
  </style>
  <link rel="preconnect" href="https://gc.zgo.at" crossorigin>
  <link rel="dns-prefetch" href="https://almanya101de.goatcounter.com">
  <meta name="google-site-verification" content="JfOdXbFKGKzlacfzwUO4cDPcyzhUZ4vefX4iKcrLSsU">
  <meta name="geo.region" content="DE">
  <meta name="geo.placename" content="Germany">
  <!-- Microsoft Clarity -->
  <script type="text/javascript">
    (function (c, l, a, r, i, t, y) {
      c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
      t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
      y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
    })(window, document, "clarity", "script", "v6b3ro6290");
  </script>
</head>

<body>
  <div class="admin-container">
    <!-- LOGIN CARD -->
    <div id="loginCard" class="login-card">
      <h2>DIK Admin Panel</h2>
      <p style="color:#666; margin-bottom:16px;">Geri bildirimleri görüntülemek için admin şifresini girin.</p>

      <div class="input-group">
        <label for="adminKey">Admin Şifresi</label>
        <input type="password" id="adminKey" placeholder="Admin şifresini girin..." />
      </div>

      <button class="btn btn-primary" onclick="login()">Giriş Yap</button>

      <div id="loginError" class="error-msg hidden" style="margin-top:16px;"></div>
    </div>

    <!-- ADMIN PANEL -->
    <div id="adminPanel" class="hidden">
      <div class="admin-card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
          <h2 style="margin:0;">Geri Bildirimler</h2>
          <button class="btn btn-secondary btn-sm" onclick="logout()">Çıkış</button>
        </div>

        <div class="stats-row">
          <div class="stat-box">
            <div class="number" id="totalCount">-</div>
            <div class="label">Toplam</div>
          </div>
          <div class="stat-box">
            <div class="number" id="pendingCount">-</div>
            <div class="label">Bekleyen</div>
          </div>
          <div class="stat-box">
            <div class="number" id="readCount">-</div>
            <div class="label">Okunmuş</div>
          </div>
        </div>

        <div class="filter-row">
          <button class="filter-btn active" data-filter="all" onclick="setFilter('all')">Tümü</button>
          <button class="filter-btn" data-filter="pending" onclick="setFilter('pending')">Bekleyen</button>
          <button class="filter-btn" data-filter="read" onclick="setFilter('read')">Okunmuş</button>
          <button class="btn btn-primary btn-sm" onclick="loadFeedback()" style="margin-left:auto;">Yenile</button>
        </div>

        <div id="feedbackError" class="error-msg hidden"></div>
        <div id="loadingState" class="loading">Yükleniyor...</div>
        <div id="emptyState" class="empty-state hidden">Henüz geri bildirim yok.</div>
        <div id="feedbackList" class="feedback-list"></div>
      </div>
    </div>
  </div>

  <script>
    let adminKey = '';
    let currentFilter = 'all';
    let allFeedback = [];

    // Check for saved key
    const savedKey = localStorage.getItem('dik_admin_key');
    if (savedKey) {
      adminKey = savedKey;
      document.getElementById('adminKey').value = savedKey;
      login();
    }

    async function login() {
      const keyInput = document.getElementById('adminKey').value.trim();
      if (!keyInput) {
        showLoginError('Şifre gerekli');
        return;
      }

      adminKey = keyInput;

      try {
        const res = await fetch(`/api/dik-admin-list?limit=1`, {
          headers: { 'x-admin-key': adminKey }
        });

        if (res.status === 401) {
          showLoginError('Geçersiz şifre');
          adminKey = '';
          return;
        }

        if (!res.ok) {
          showLoginError('Sunucu hatası');
          return;
        }

        // Success - save key and show panel
        localStorage.setItem('dik_admin_key', adminKey);
        document.getElementById('loginCard').classList.add('hidden');
        document.getElementById('adminPanel').classList.remove('hidden');
        loadFeedback();
      } catch (err) {
        showLoginError('Bağlantı hatası: ' + err.message);
      }
    }

    function logout() {
      adminKey = '';
      localStorage.removeItem('dik_admin_key');
      document.getElementById('adminPanel').classList.add('hidden');
      document.getElementById('loginCard').classList.remove('hidden');
      document.getElementById('adminKey').value = '';
    }

    function showLoginError(msg) {
      const el = document.getElementById('loginError');
      el.textContent = msg;
      el.classList.remove('hidden');
    }

    function setFilter(filter) {
      currentFilter = filter;
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.filter === filter);
      });
      renderFeedback();
    }

    async function loadFeedback() {
      const loadingEl = document.getElementById('loadingState');
      const errorEl = document.getElementById('feedbackError');
      const listEl = document.getElementById('feedbackList');
      const emptyEl = document.getElementById('emptyState');

      loadingEl.classList.remove('hidden');
      errorEl.classList.add('hidden');
      listEl.innerHTML = '';
      emptyEl.classList.add('hidden');

      try {
        const res = await fetch(`/api/dik-admin-list?limit=200`, {
          headers: { 'x-admin-key': adminKey }
        });

        if (!res.ok) {
          throw new Error('Failed to load');
        }

        const data = await res.json();
        allFeedback = data.items || [];

        updateStats();
        renderFeedback();
      } catch (err) {
        errorEl.textContent = 'Yükleme hatası: ' + err.message;
        errorEl.classList.remove('hidden');
      } finally {
        loadingEl.classList.add('hidden');
      }
    }

    function updateStats() {
      const total = allFeedback.length;
      const pending = allFeedback.filter(f => f.status === 'pending').length;
      const read = allFeedback.filter(f => f.status === 'read').length;

      document.getElementById('totalCount').textContent = total;
      document.getElementById('pendingCount').textContent = pending;
      document.getElementById('readCount').textContent = read;
    }

    function renderFeedback() {
      const listEl = document.getElementById('feedbackList');
      const emptyEl = document.getElementById('emptyState');

      let filtered = allFeedback;
      if (currentFilter !== 'all') {
        filtered = allFeedback.filter(f => f.status === currentFilter);
      }

      if (filtered.length === 0) {
        listEl.innerHTML = '';
        emptyEl.classList.remove('hidden');
        return;
      }

      emptyEl.classList.add('hidden');

      listEl.innerHTML = filtered.map(item => {
        const date = new Date(item.created_at).toLocaleString('tr-TR');
        const statusClass = item.status === 'read' ? 'read' : 'pending';

        return `
          <div class="feedback-item ${statusClass}" data-id="${item.id}">
            <div class="feedback-header">
              <span class="feedback-meta">
                #${item.id} &middot; ${date}
              </span>
              <span class="feedback-status ${statusClass}">${item.status === 'read' ? 'Okundu' : 'Bekliyor'}</span>
            </div>
            <div class="feedback-message">${escapeHtml(item.message)}</div>
            <div class="feedback-actions">
              ${item.status === 'pending'
                ? `<button class="btn btn-success btn-sm" onclick="markRead(${item.id})">Okundu İşaretle</button>`
                : `<button class="btn btn-secondary btn-sm" onclick="markPending(${item.id})">Bekleyene Al</button>`
              }
              <button class="btn btn-danger btn-sm" onclick="deleteFeedback(${item.id})">Sil</button>
            </div>
          </div>
        `;
      }).join('');
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    async function markRead(id) {
      await doAction('mark_read', id);
    }

    async function markPending(id) {
      await doAction('mark_pending', id);
    }

    async function deleteFeedback(id) {
      if (!confirm('Bu geri bildirimi silmek istediğinize emin misiniz?')) return;
      await doAction('delete', id);
    }

    async function doAction(action, id) {
      try {
        const res = await fetch('/api/dik-admin-action', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-admin-key': adminKey
          },
          body: JSON.stringify({ action, id })
        });

        if (!res.ok) {
          const data = await res.json();
          alert('Hata: ' + (data.error || 'İşlem başarısız'));
          return;
        }

        // Refresh list
        loadFeedback();
      } catch (err) {
        alert('Hata: ' + err.message);
      }
    }

    // Enter key for login
    document.getElementById('adminKey').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') login();
    });
  </script>
  <!-- GoatCounter Analytics -->
  <script>
    window.goatcounter = window.goatcounter || {};
    window.goatcounter.path = location.pathname;
  </script>
  <script data-goatcounter="https://almanya101de.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
          
      <div style="font-size: 12.5px; line-height: 1.2; margin-top: 2px;">yaln&#305;z de&#287;ilsin! almanya101 seninle!</div>
      <div style="font-size: 13.5px; line-height: 1.2; margin-top: 4px;">made by UBT with love</div>
      <div style="font-size: 13.5px; line-height: 1.2; margin-top: 2px;">&copy;almanya101de &#8226; 2026</div>
    </div>

  </div>
</div>
</div>

<div style="font-size: 12.5px; line-height: 1.2; margin-top: 2px;">yaln&#305;z de&#287;ilsin! almanya101 seninle!</div>
      <div style="font-size: 13.5px; line-height: 1.2; margin-top: 4px;">made by UBT with love</div>
      <div style="font-size: 13.5px; line-height: 1.2; margin-top: 2px;">&copy;almanya101de &#8226; 2026</div>
    </div>
  </div>

  <div class="footer-blue-card-wrap">
      <div class="card footer-blue-card">
        <div class="card-buttons footer-blue-card__buttons">
          <a href="../index.html">
            <img src="../img/buttons/z0cliphome.png" class="btn-icon" alt="Home" />
          </a>
          <a href="#top">
            <img src="../img/buttons/z0clipup.png" class="btn-icon" alt="Up" />
          </a>
          <button type="button" class="btn-icon" title="Menu" onclick="document.getElementById('menuOpenBtn') && document.getElementById('menuOpenBtn').click()" style="background: none; border: none; padding: 0; cursor: pointer;">
            <img src="../img/buttons/z0clipmenu.png" class="btn-icon" alt="Menu" />
          </button>
        </div>
        <div class="footer-slogan">yalnız değilsin! almanya101 seninle!</div>
        <div class="footer-credit">made by UBT with love</div>
        <div class="footer-copyright">&copy;almanya101de &bull; 2026</div>
      </div>
    </div>

  <script src="/shared-cards.js"></script>
</body>
</html>



