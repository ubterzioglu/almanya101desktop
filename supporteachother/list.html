<!doctype html>
<html lang="tr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/png" href="../img/icons/headericon.png" />
  <title>Support Each Other - almanya101 | Almanya'daki TÃ¼rk Developer'larÄ± KeÅŸfet</title>
  <meta name="title" content="Support Each Other - almanya101">
  <meta name="description"
    content="Hep destek tam destek! DesteÄŸe ihtiyaÃ§ duyduÄŸunda yanÄ±nda olacak insanlarÄ± bul! Birlikte daha gÃ¼Ã§lÃ¼yuz!">
  <meta name="robots" content="noindex, nofollow">

  <link rel="stylesheet" href="list.css" />
</head>

<body>
  <div class="container1">

    <!-- Hero Card -->
    <div class="card hero-card1">
      <div class="hero-domain1">almanya101.de</div>
      <h3>Destek Ara</h3>
    </div>

    <!-- Filter Card -->
    <div class="card">
      <h4 style="margin-top: 0; color: #F65314;">ğŸ” Filtrele</h4>
      
      <div class="filter-section">
        <div class="filter-group">
          <label>Åehir</label>
          <input type="text" id="filterSehir" placeholder="Ã–rn: Berlin, MÃ¼nchen">
        </div>

        <div class="filter-group">
          <label>Rol</label>
          <select id="filterRol">
            <option value="">TÃ¼mÃ¼</option>
            <option value="Software Developer">Software Developer</option>
            <option value="QA / Test">QA / Test</option>
            <option value="DevOps">DevOps</option>
            <option value="Data / AI">Data / AI</option>
            <option value="Product / Project">Product / Project</option>
            <option value="UI/UX">UI/UX</option>
            <option value="Ã–ÄŸrenci">Ã–ÄŸrenci</option>
            <option value="DiÄŸer">DiÄŸer</option>
          </select>
        </div>

        <div class="filter-group">
          <label>Deneyim</label>
          <select id="filterDeneyim">
            <option value="">TÃ¼mÃ¼</option>
            <option value="0â€“1 yÄ±l">0â€“1 yÄ±l</option>
            <option value="1â€“3 yÄ±l">1â€“3 yÄ±l</option>
            <option value="3â€“5 yÄ±l">3â€“5 yÄ±l</option>
            <option value="5â€“10 yÄ±l">5â€“10 yÄ±l</option>
            <option value="10+ yÄ±l">10+ yÄ±l</option>
          </select>
        </div>

        <div class="filter-group">
          <label>Ä°ÅŸ Arama Durumu</label>
          <select id="filterIsArama">
            <option value="">TÃ¼mÃ¼</option>
            <option value="Evet, aktif">Aktif iÅŸ arÄ±yor</option>
            <option value="Evet, pasif (fÄ±rsat olursa)">Pasif iÅŸ arÄ±yor</option>
            <option value="Sadece freelance bakÄ±yorum">Freelance arÄ±yor</option>
            <option value="HayÄ±r">Ä°ÅŸ aramÄ±yor</option>
          </select>
        </div>

        <div class="filter-group">
          <label>Teknoloji</label>
          <input type="text" id="filterTech" placeholder="Ã–rn: React, Python, AWS">
        </div>

        <div class="filter-group">
          <label>Ä°lgi AlanÄ±</label>
          <input type="text" id="filterIlgi" placeholder="Ã–rn: AI, Startup, Freelance">
        </div>
      </div>

      <div class="filter-actions">
        <button class="btn btn-primary" id="applyFilters">Filtrele</button>
        <button class="btn btn-secondary" id="clearFilters">Temizle</button>
      </div>
    </div>

    <!-- Results Count Card -->
    <div class="results-count-card" id="resultsCountCard" style="display: none;">
      <h4>ğŸ‘¥ Topluluk Ãœyeleri</h4>
      <span class="results-count" id="resultsCount"></span>
    </div>

    <!-- Loading State -->
    <div class="loading" id="loadingState">
      <p>Ãœyeler yÃ¼klen iyor...</p>
    </div>

    <!-- User Grid (no outer card) -->
    <div class="user-grid hidden" id="userGrid"></div>

    <!-- Empty State -->
    <div class="empty-state hidden" id="emptyState">
      <h4>ğŸ” SonuÃ§ bulunamadÄ±</h4>
      <p>Filtreleri deÄŸiÅŸtirerek tekrar deneyin.</p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="config.js"></script>
  <script>
    // Initialize Supabase
    const { createClient } = supabase;
    const supabaseClient = createClient(window.SUPABASE_CONFIG.url, window.SUPABASE_CONFIG.anonKey);

    let allUsers = [];

    // Load users
    async function loadUsers() {
      try {
        const { data, error } = await supabaseClient
          .from('supporteachother')
          .select('*')
          .eq('aratilabilir', true)
          .order('created_at', { ascending: false });

        if (error) throw error;

        allUsers = data || [];
        displayUsers(allUsers);
      } catch (error) {
        // Error loading users
        document.getElementById('loadingState').innerHTML = '<p style="color: #ff0000;">YÃ¼kleme hatasÄ±. LÃ¼tfen sayfayÄ± yenileyin.</p>';
      }
    }

    // Display users
    function displayUsers(users) {
      const loadingState = document.getElementById('loadingState');
      const userGrid = document.getElementById('userGrid');
      const emptyState = document.getElementById('emptyState');
      const resultsCount = document.getElementById('resultsCount');

      loadingState.classList.add('hidden');
      const resultsCountCard = document.getElementById('resultsCountCard');

      if (users.length === 0) {
        userGrid.classList.add('hidden');
        emptyState.classList.remove('hidden');
        resultsCountCard.style.display = 'none';
        return;
      }

      emptyState.classList.add('hidden');
      userGrid.classList.remove('hidden');
      resultsCountCard.style.display = 'block';
      resultsCount.textContent = `${users.length} Ã¼ye`;

      userGrid.innerHTML = users.map(user => createUserCard(user)).join('');
    }

    // Create user card HTML
    function createUserCard(user) {
      const techStack = [
        ...(user.programlama_dilleri || []),
        ...(user.framework_platformlar || []),
        ...(user.devops_cloud || [])
      ].slice(0, 8);

      const badges = [];
      if (user.is_arama_durumu === 'Evet, aktif') {
        badges.push('<span class="badge badge-green">ğŸŸ¢ Aktif iÅŸ arÄ±yor</span>');
      } else if (user.is_arama_durumu === 'Evet, pasif (fÄ±rsat olursa)') {
        badges.push('<span class="badge">ğŸŸ¡ Pasif iÅŸ arÄ±yor</span>');
      }
      if (user.freelance_aciklik && user.freelance_aciklik !== 'HayÄ±r') {
        badges.push('<span class="badge">ğŸ’¼ Freelance aÃ§Ä±k</span>');
      }
      if (user.profesyonel_destek_verebilir) {
        badges.push('<span class="badge">ğŸ“ Mentorluk verebilir</span>');
      }

      const linkedinBtn = user.linkedin_url 
        ? `<a href="${user.linkedin_url}" target="_blank" class="action-btn">LinkedIn</a>`
        : '';
      
      const whatsappBtn = user.whatsapp_tel && user.iletisim_izni
        ? `<a href="https://wa.me/${user.whatsapp_tel.replace(/[^0-9]/g, '')}" target="_blank" class="action-btn">WhatsApp</a>`
        : '';

      return `
        <div class="user-card">
          <div class="user-header">
            <div>
              <h3 class="user-name">${escapeHtml(user.ad_soyad)}</h3>
              <div class="user-role">${escapeHtml(user.rol || 'Developer')}</div>
            </div>
          </div>

          ${badges.length > 0 ? `<div class="user-badges">${badges.join('')}</div>` : ''}

          <div class="user-info">
            ${user.sehir ? `<div class="info-row"><span class="info-icon">ğŸ“</span> ${escapeHtml(user.sehir)}</div>` : ''}
            ${user.deneyim_seviye ? `<div class="info-row"><span class="info-icon">â±ï¸</span> ${escapeHtml(user.deneyim_seviye)} deneyim</div>` : ''}
            ${user.almanya_yasam ? `<div class="info-row"><span class="info-icon">ğŸ‡©ğŸ‡ª</span> Almanya'da yaÅŸÄ±yor</div>` : ''}
          </div>

          ${user.guclu_alanlar && user.guclu_alanlar.length > 0 ? `
            <div class="section-title">GÃ¼Ã§lÃ¼ Alanlar</div>
            <div class="tech-tags">
              ${user.guclu_alanlar.slice(0, 5).map(alan => `<span class="tech-tag">${escapeHtml(alan)}</span>`).join('')}
            </div>
          ` : ''}

          ${techStack.length > 0 ? `
            <div class="section-title">Teknoloji Stack</div>
            <div class="tech-tags">
              ${techStack.map(tech => `<span class="tech-tag">${escapeHtml(tech)}</span>`).join('')}
            </div>
          ` : ''}

          ${user.ilgi_konular && user.ilgi_konular.length > 0 ? `
            <div class="section-title">Ä°lgi AlanlarÄ±</div>
            <div class="tech-tags">
              ${user.ilgi_konular.slice(0, 4).map(ilgi => `<span class="tech-tag">${escapeHtml(ilgi)}</span>`).join('')}
            </div>
          ` : ''}

          ${linkedinBtn || whatsappBtn ? `
            <div class="user-actions">
              ${linkedinBtn}
              ${whatsappBtn}
            </div>
          ` : ''}
        </div>
      `;
    }

    // Escape HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Filter users
    function filterUsers() {
      const sehir = document.getElementById('filterSehir').value.toLowerCase().trim();
      const rol = document.getElementById('filterRol').value;
      const deneyim = document.getElementById('filterDeneyim').value;
      const isArama = document.getElementById('filterIsArama').value;
      const tech = document.getElementById('filterTech').value.toLowerCase().trim();
      const ilgi = document.getElementById('filterIlgi').value.toLowerCase().trim();

      // Check if any filter is active
      const hasActiveFilter = sehir || rol || deneyim || isArama || tech || ilgi;
      
      // If no filters, show all
      if (!hasActiveFilter) {
        displayUsers(allUsers);
        return;
      }

      const filtered = allUsers.filter(user => {
        const matches = [];
        
        // Åehir match (OR logic for comma-separated values)
        if (sehir) {
          const sehirList = sehir.split(',').map(s => s.trim()).filter(s => s);
          const sehirMatch = sehirList.some(s => user.sehir && user.sehir.toLowerCase().includes(s));
          matches.push(sehirMatch);
        }
        
        // Rol match
        if (rol) {
          matches.push(user.rol === rol);
        }
        
        // Deneyim match
        if (deneyim) {
          matches.push(user.deneyim_seviye === deneyim);
        }
        
        // Ä°ÅŸ arama match
        if (isArama) {
          matches.push(user.is_arama_durumu === isArama);
        }
        
        // Teknoloji match (OR logic for comma-separated values)
        if (tech) {
          const techList = tech.split(',').map(t => t.trim()).filter(t => t);
          const allTech = [
            ...(user.programlama_dilleri || []),
            ...(user.framework_platformlar || []),
            ...(user.devops_cloud || [])
          ].map(t => t.toLowerCase());
          const techMatch = techList.some(t => allTech.some(ut => ut.includes(t)));
          matches.push(techMatch);
        }
        
        // Ä°lgi alanÄ± match (OR logic for comma-separated values)
        if (ilgi) {
          const ilgiList = ilgi.split(',').map(i => i.trim()).filter(i => i);
          const allIlgi = (user.ilgi_konular || []).map(i => i.toLowerCase());
          const ilgiMatch = ilgiList.some(i => allIlgi.some(ui => ui.includes(i)));
          matches.push(ilgiMatch);
        }
        
        // OR logic: return true if ANY filter matches
        return matches.some(m => m === true);
      });

      displayUsers(filtered);
    }

    // Clear filters
    function clearFilters() {
      document.getElementById('filterSehir').value = '';
      document.getElementById('filterRol').value = '';
      document.getElementById('filterDeneyim').value = '';
      document.getElementById('filterIsArama').value = '';
      document.getElementById('filterTech').value = '';
      document.getElementById('filterIlgi').value = '';
      displayUsers(allUsers);
    }

    // Event listeners
    document.getElementById('applyFilters').addEventListener('click', filterUsers);
    document.getElementById('clearFilters').addEventListener('click', clearFilters);

    // Load on page load
    loadUsers();
  </script>
</body>

</html>
